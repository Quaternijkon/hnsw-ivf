# Faiss 磁盘 vs 内存磁盘性能对比分析

## 测试环境
- 测试时间: 2025-10-20 06:54:45
- 系统: Linux 5.15.0-97-generic
- 内存: 219Gi
- CPU: 80 核心

## 存储介质
- **普通磁盘**: 本地文件系统（NVMe SSD）
- **内存磁盘**: tmpfs (4GB)

## 性能对比表

### 1. QPS（每秒查询数）对比

| 线程数 | 普通磁盘 QPS | 内存磁盘 QPS | 性能提升 | 提升百分比 |
|--------|--------------|--------------|----------|-----------|
|      1 |       470.32 |       481.21 |   +10.89 |   +2.32% |
|      5 |      1743.09 |      1774.85 |   +31.76 |   +1.82% |
|     10 |      2721.91 |      2504.73 |  -217.18 |   -7.98% |
|     15 |      3020.21 |      2553.98 |  -466.23 |  -15.44% |
|     20 |      2886.85 |      3417.87 |  +531.02 |  +18.39% |

### 2. 延迟（毫秒）对比

| 线程数 | 指标 | 普通磁盘 | 内存磁盘 | 改善 |
|--------|------|---------|---------|------|
|      1 | 平均 |  2.1163 |  2.0679 | +0.0484 |
|      1 | P99  |  3.3439 |  3.3366 | +0.0073 |
|      5 | 平均 |  2.7162 |  2.6392 | +0.0770 |
|      5 | P99  |  3.8081 |  3.6711 | +0.1370 |
|     10 | 平均 |  3.3502 |  3.8709 | -0.5207 |
|     10 | P99  |  5.3360 |  5.3946 | -0.0586 |
|     15 | 平均 |  4.5196 |  5.6448 | -1.1252 |
|     15 | P99  |  6.8027 |  8.2875 | -1.4848 |
|     20 | 平均 |  6.2463 |  5.2833 | +0.9630 |
|     20 | P99  |  9.8976 |  9.4883 | +0.4093 |

### 3. 功耗（瓦特）和能效对比

| 线程数 | 普通磁盘功耗 | 内存磁盘功耗 | 普通磁盘能效 | 内存磁盘能效 |
|--------|-------------|-------------|-------------|-------------|
|      1 |       60.00W |       60.00W |        7.84 |        8.02 |
|      5 |      100.00W |      100.00W |       17.43 |       17.75 |
|     10 |      150.00W |      150.00W |       18.15 |       16.70 |
|     15 |      200.00W |      200.00W |       15.10 |       12.77 |
|     20 |      250.00W |      250.00W |       11.55 |       13.67 |

*能效 = QPS/瓦特，越高越好*

## 关键发现

### 1. QPS性能分析
- 平均性能提升: **-0.18%**
- 最大性能提升: **20 线程时达到 +18.39%**

### 2. 延迟分析
- 普通磁盘平均P99延迟: **5.8377 ms**
- 内存磁盘平均P99延迟: **6.0356 ms**
- 延迟改善: **-0.1980 ms** (-3.39%)

### 3. 磁盘I/O瓶颈评估
- ✅ **磁盘I/O不是性能瓶颈**（平均性能提升仅 -0.18%）
- **建议**: 当前存储配置已经很好，无需额外优化

### 4. 最优配置建议
- **普通磁盘最优配置**: 15 线程 (QPS: 3020.21)
- **内存磁盘最优配置**: 20 线程 (QPS: 3417.87)
- **最优配置下的性能提升**: +13.17%

### 5. 能效分析
- **普通磁盘最高能效**: 10 线程 (能效: 18.15 QPS/W)
- **内存磁盘最高能效**: 5 线程 (能效: 17.75 QPS/W)

## 原始数据

### 普通磁盘测试结果
```csv
Threads,Time(s),QPS,Avg Power(W),CPU Energy(J),Mem Energy(J),Power/Query(mJ),Efficiency,Avg Lat(ms),P50 Lat(ms),P99 Lat(ms),Max Lat(ms),Min Lat(ms),Peak Mem(MB)
1,21.2622,470.32,60.00,1020.5840,255.1460,2712.4786,7.84,2.1163,2.0256,3.3439,4.0179,1.4091,729.50
5,5.7369,1743.09,100.00,458.9558,114.7390,329.1257,17.43,2.7162,2.6915,3.8081,5.3776,1.5653,729.50
10,3.6739,2721.91,150.00,440.8662,110.2166,202.4615,18.15,3.3502,3.2506,5.3360,7.0943,1.8275,729.50
15,3.3110,3020.21,200.00,529.7644,132.4411,219.2581,15.10,4.5196,4.6265,6.8027,8.8482,1.8162,734.77
20,3.4640,2886.85,250.00,692.7964,173.1991,299.9793,11.55,6.2463,6.4123,9.8976,12.2378,1.8584,745.42
```

### 内存磁盘测试结果
```csv
Threads,Time(s),QPS,Avg Power(W),CPU Energy(J),Mem Energy(J),Power/Query(mJ),Efficiency,Avg Lat(ms),P50 Lat(ms),P99 Lat(ms),Max Lat(ms),Min Lat(ms),Peak Mem(MB)
1,20.7810,481.21,60.00,997.4875,249.3719,2591.0970,8.02,2.0679,1.9819,3.3366,4.1352,1.4040,729.28
5,5.6343,1774.85,100.00,450.7424,112.6856,317.4511,17.75,2.6392,2.6182,3.6711,5.4318,1.5003,729.28
10,3.9924,2504.73,150.00,479.0931,119.7733,239.0939,16.70,3.8709,3.8643,5.3946,8.2791,1.6580,729.28
15,3.9155,2553.98,200.00,626.4734,156.6183,306.6163,12.77,5.6448,5.5912,8.2875,9.8695,1.9434,731.74
20,2.9258,3417.87,250.00,585.1602,146.2901,214.0078,13.67,5.2833,5.0875,9.4883,15.4045,1.7546,737.65
```