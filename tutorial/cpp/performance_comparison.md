# Faiss 性能对比实验报告

## 实验目的
通过对比普通磁盘和内存磁盘的性能表现，分析磁盘I/O是否在高线程数下成为性能瓶颈。

## 测试环境
- 测试时间: Mon Oct 13 09:56:11 AM UTC 2025
- 系统: Linux 5.15.0-97-generic
- 内存: 219Gi
- CPU: 80 核心

## 存储介质信息
- 普通磁盘: 本地文件系统
- 内存磁盘: tmpfs (2GB)

## 测试结果

### 性能对比表

| 线程数 | 普通磁盘QPS | 内存磁盘QPS | 性能提升 | 普通磁盘延迟(ms) | 内存磁盘延迟(ms) |
|--------|-------------|-------------|----------|------------------|------------------|
普通磁盘测试结果:
```
Threads,Time(s),QPS,Avg Power(W),CPU Energy(J),Mem Energy(J),Power/Query(mJ),Efficiency,Avg Lat(ms),P50 Lat(ms),P99 Lat(ms),Max Lat(ms),Min Lat(ms),Peak Mem(MB)
1,20.0959,497.62,60.00,964.6010,241.1503,2423.0603,8.29,2.0043,1.9221,3.3921,4.5211,1.3666,1369.80
2,11.8393,844.64,70.00,663.0005,165.7501,981.1823,12.07,2.3323,2.3057,3.1672,6.9254,1.5652,1369.80
3,8.6259,1159.30,80.00,552.0593,138.0148,595.2530,14.49,2.4576,2.3710,4.0045,5.1708,1.3211,1369.80
4,6.9367,1441.61,90.00,499.4433,124.8608,433.0618,16.02,2.6990,2.6729,3.6683,4.7484,1.5868,1369.80
5,5.4741,1826.77,100.00,437.9314,109.4829,299.6624,18.27,2.5422,2.5078,3.6518,5.7129,1.4652,1369.80
6,5.0349,1986.13,110.00,443.0722,110.7680,278.8536,18.06,2.8495,2.8284,4.2119,5.0374,1.5595,1369.80
7,5.0482,1980.90,120.00,484.6281,121.1570,305.8130,16.51,3.2782,3.1645,5.7258,7.4757,1.6230,1369.80
8,4.5917,2177.84,130.00,477.5370,119.3843,274.0885,16.75,3.5163,3.4675,5.3047,7.0959,1.7315,1369.80
9,4.2409,2357.97,140.00,474.9854,118.7463,251.7981,16.84,3.5488,3.4368,6.0675,8.2343,1.6829,1369.80
```

内存磁盘测试结果:
```
Threads,Time(s),QPS,Avg Power(W),CPU Energy(J),Mem Energy(J),Power/Query(mJ),Efficiency,Avg Lat(ms),P50 Lat(ms),P99 Lat(ms),Max Lat(ms),Min Lat(ms),Peak Mem(MB)
1,25.1221,398.06,60.00,1205.8600,301.4650,3786.7145,6.63,2.5062,2.3924,4.5597,25.3250,1.3724,1366.67
2,19.8354,504.15,70.00,1110.7808,277.6952,2754.0938,7.20,3.7916,3.3480,16.7713,47.7674,2.3607,1366.67
3,15.8809,629.69,80.00,1016.3784,254.0946,2017.6270,7.87,4.6239,4.1826,18.0109,48.8676,2.5007,1366.67
4,13.4583,743.04,90.00,968.9976,242.2494,1630.1324,8.26,5.1752,4.2815,20.5773,55.1071,2.5867,1366.67
5,11.2813,886.42,100.00,902.5048,225.6262,1272.6796,8.86,5.1994,4.7499,18.7787,47.7812,2.4487,1366.67
6,10.6834,936.03,110.00,940.1371,235.0343,1255.4797,8.51,5.8481,5.1600,22.2769,34.1272,2.9900,1366.67
7,9.5508,1047.03,120.00,916.8760,229.2190,1094.6115,8.73,6.0967,5.0043,23.0948,41.2485,2.7948,1366.67
8,9.7601,1024.58,130.00,1015.0462,253.7615,1238.3639,7.88,7.1449,5.7599,26.0322,43.5691,2.9016,1366.67
9,8.8253,1133.10,140.00,988.4360,247.1090,1090.4082,8.09,7.4976,5.7230,25.3538,41.3718,2.8776,1366.67
```


## 分析结论

### 磁盘I/O瓶颈分析
通过对比两种存储介质的性能表现，可以得出以下结论：

1. **高线程数下的性能差异**: 如果内存磁盘在高线程数下表现明显优于普通磁盘，说明存在磁盘I/O瓶颈
2. **最优线程数**: 找出两种存储介质下的最优线程配置
3. **性能提升幅度**: 量化磁盘I/O瓶颈对整体性能的影响

### 优化建议
- 如果存在明显性能差异，建议考虑使用SSD或增加内存缓存
- 根据测试结果调整线程数配置
- 考虑使用内存映射文件优化I/O性能

## 文件说明
- `disk_results.csv`: 普通磁盘测试结果
- `memory_results.csv`: 内存磁盘测试结果  
- `disk_test.log`: 普通磁盘测试日志
- `memory_test.log`: 内存磁盘测试日志
