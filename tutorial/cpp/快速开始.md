# 🚀 快速开始指南

## ✅ 问题已解决

程序崩溃问题已完全修复！详细分析见 [`问题分析报告.md`](./问题分析报告.md)

## 📝 如何运行测试

### 🎯 选项1: 完整对比测试（磁盘 vs 内存磁盘）

**推荐：需要完整性能对比时使用**

在您的终端中手动运行（需要输入 sudo 密码）：

```bash
cd /home/gpu/dry/faiss/tutorial/cpp
./simple_disk_memory_test.sh
```

**特点：**
- ✅ 对比普通磁盘和内存磁盘性能
- ✅ 分析磁盘I/O瓶颈
- ✅ 生成详细对比报告
- ⚠️ 需要 sudo 权限
- ⚠️ 需要 6GB+ 可用内存

**生成文件：**
- `disk_results.csv` - 普通磁盘性能数据
- `memory_results.csv` - 内存磁盘性能数据
- `performance_comparison.md` - 对比分析报告
- `disk_test.log` / `memory_test.log` - 详细日志

---

### ⚡ 选项2: 快速磁盘测试（无需sudo）

**推荐：快速验证或没有sudo权限时使用**

```bash
cd /home/gpu/dry/faiss/tutorial/cpp
./run_disk_test_only.sh
```

**特点：**
- ✅ 无需 sudo 权限
- ✅ 快速运行
- ✅ 直接测试当前磁盘性能
- ❌ 不包含内存磁盘对比

**生成文件：**
- `benchmark_results.txt` - 性能数据（CSV格式）
- `disk_performance_test.log` - 详细日志

---

### 🔧 选项3: 直接运行基准测试

**最简单：仅运行核心程序**

```bash
cd /home/gpu/dry/faiss/tutorial/cpp
./benchmark-thread
```

运行后会在屏幕上直接显示结果，并生成 `benchmark_results.txt`

---

## 📋 运行前准备

### 1. 检查数据和系统资源

```bash
cd /home/gpu/dry/faiss/tutorial/cpp
./check_data_size.sh
```

### 2. 清理旧测试环境（可选）

```bash
./cleanup_and_rerun.sh
```

---

## 🎯 推荐流程

### 首次运行：

```bash
# 1. 进入目录
cd /home/gpu/dry/faiss/tutorial/cpp

# 2. 检查环境
./check_data_size.sh

# 3. 选择测试方式（三选一）：

# 方式A: 完整对比测试（推荐）
./simple_disk_memory_test.sh

# 方式B: 快速磁盘测试
./run_disk_test_only.sh

# 方式C: 直接运行
./benchmark-thread
```

### 后续运行：

```bash
# 清理后重新运行
./cleanup_and_rerun.sh
# 然后在提示时选择 'y' 直接运行
```

---

## 📊 测试配置

当前配置（在 `benchmark-thread.cpp` 中）：

```cpp
// 第520行：测试的线程数
std::vector<int> thread_counts = {1,5,10,15,20};

// 第522行：每个配置的运行次数
const int num_runs_per_thread_setting = 1;
```

**修改建议：**

- **快速验证**: `{1,5,10}` + `1次运行` （3-5分钟）
- **标准测试**: `{1,5,10,15,20}` + `1次运行` （5-10分钟）
- **详细测试**: `{1,5,10,15,20,25,30,40}` + `3次运行` （20-30分钟）
- **完整扫描**: `{1,2,3,...,100}` + `3次运行` （1-2小时）

---

## 📈 预期测试时间

| 测试类型 | 首次运行 | 后续运行 | 说明 |
|---------|---------|---------|------|
| 完整对比测试 | 15-25分钟 | 8-15分钟 | 需要构建索引（首次） |
| 快速磁盘测试 | 10-15分钟 | 5-10分钟 | 包含索引构建 |
| 直接运行 | 10-15分钟 | 5-10分钟 | 最简单 |

*注：首次运行需要构建索引，后续运行会复用已有索引*

---

## ❓ 常见问题

### Q1: 提示 "sudo: a terminal is required"

**原因**: 脚本需要 sudo 权限创建内存磁盘

**解决**: 
- 在真实终端中手动运行脚本，或
- 使用不需要 sudo 的选项2或选项3

### Q2: "memory_workspace 无法删除"

**解决**:
```bash
sudo umount memory_workspace 2>/dev/null
rmdir memory_workspace
# 或运行
./cleanup_and_rerun.sh
```

### Q3: 想测试更多线程配置

编辑 `benchmark-thread.cpp` 第520行：

```cpp
// 修改前
std::vector<int> thread_counts = {1,5,10,15,20};

// 修改后（例如）
std::vector<int> thread_counts = {1,2,4,8,16,32,64};
```

然后重新编译：
```bash
g++ -std=c++17 -O3 -o benchmark-thread benchmark-thread.cpp \
    -I ../.. -L ../../build/faiss \
    -Wl,-rpath,../../build/faiss -lfaiss -lopenblas -fopenmp
```

### Q4: 索引文件已存在，想重新构建

```bash
rm ./sift/*.index
./run_disk_test_only.sh  # 或其他测试脚本
```

---

## 📁 相关文档

- 📖 [`使用说明.md`](./使用说明.md) - 完整使用手册
- 🔍 [`问题分析报告.md`](./问题分析报告.md) - 问题诊断详情
- 🛠️ `check_data_size.sh` - 数据检查工具
- 🧹 `cleanup_and_rerun.sh` - 清理和重运行工具

---

## ✨ 现在就开始吧！

您的系统资源充足（212GB可用内存），所有问题已修复，可以安全运行测试了！

**推荐命令：**

```bash
cd /home/gpu/dry/faiss/tutorial/cpp

# 如果有sudo权限，运行完整对比测试：
./simple_disk_memory_test.sh

# 或者，快速测试（无需sudo）：
./run_disk_test_only.sh
```

祝测试顺利！🎉

