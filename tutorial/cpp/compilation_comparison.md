# ç¼–è¯‘åŠŸèƒ½ä¸€è‡´æ€§å¯¹æ¯”

## ç¼–è¯‘å‘½ä»¤å¯¹æ¯”

### æ‚¨åŸå…ˆçš„ç¼–è¯‘å‘½ä»¤
```bash
g++ -std=c++17 -O3 -o benchmark-thread benchmark-thread.cpp -I ../.. -L ../../build/faiss -Wl,-rpath,../../build/faiss -lfaiss -lopenblas -fopenmp
```

### æˆ‘çš„ç¼–è¯‘è„šæœ¬ç”Ÿæˆçš„å‘½ä»¤
```bash
g++ -std=c++17 -O3 -fopenmp -I ../.. benchmark-thread-disk.cpp -o benchmark-thread-disk -L ../../build/faiss -Wl,-rpath,../../build/faiss -lfaiss -lopenblas
```

## åŠŸèƒ½å¯¹æ¯”è¡¨

| ç¼–è¯‘é€‰é¡¹ | æ‚¨çš„å‘½ä»¤ | æˆ‘çš„è„šæœ¬ | æ˜¯å¦ä¸€è‡´ | è¯´æ˜ |
|----------|----------|----------|----------|------|
| ç¼–è¯‘å™¨ | `g++` | `g++` | âœ… | å®Œå…¨ç›¸åŒ |
| C++æ ‡å‡† | `-std=c++17` | `-std=c++17` | âœ… | å®Œå…¨ç›¸åŒ |
| ä¼˜åŒ–çº§åˆ« | `-O3` | `-O3` | âœ… | å®Œå…¨ç›¸åŒ |
| OpenMP | `-fopenmp` | `-fopenmp` | âœ… | å®Œå…¨ç›¸åŒ |
| å¤´æ–‡ä»¶è·¯å¾„ | `-I ../..` | `-I ../..` | âœ… | å®Œå…¨ç›¸åŒ |
| åº“æ–‡ä»¶è·¯å¾„ | `-L ../../build/faiss` | `-L ../../build/faiss` | âœ… | å®Œå…¨ç›¸åŒ |
| è¿è¡Œæ—¶è·¯å¾„ | `-Wl,-rpath,../../build/faiss` | `-Wl,-rpath,../../build/faiss` | âœ… | å®Œå…¨ç›¸åŒ |
| Faissåº“ | `-lfaiss` | `-lfaiss` | âœ… | å®Œå…¨ç›¸åŒ |
| OpenBLASåº“ | `-lopenblas` | `-lopenblas` | âœ… | å®Œå…¨ç›¸åŒ |
| æºæ–‡ä»¶ | `benchmark-thread.cpp` | `benchmark-thread-disk.cpp` | ğŸ”„ | ä¸åŒæ–‡ä»¶å |
| è¾“å‡ºæ–‡ä»¶ | `benchmark-thread` | `benchmark-thread-disk` | ğŸ”„ | ä¸åŒæ–‡ä»¶å |

## è¯¦ç»†åˆ†æ

### âœ… å®Œå…¨ä¸€è‡´çš„åŠŸèƒ½
1. **ç¼–è¯‘å™¨**: éƒ½ä½¿ç”¨ `g++`
2. **C++æ ‡å‡†**: éƒ½ä½¿ç”¨ `-std=c++17`
3. **ä¼˜åŒ–çº§åˆ«**: éƒ½ä½¿ç”¨ `-O3`
4. **å¹¶è¡Œæ”¯æŒ**: éƒ½ä½¿ç”¨ `-fopenmp`
5. **å¤´æ–‡ä»¶è·¯å¾„**: éƒ½ä½¿ç”¨ `-I ../..`
6. **åº“æ–‡ä»¶è·¯å¾„**: éƒ½ä½¿ç”¨ `-L ../../build/faiss`
7. **è¿è¡Œæ—¶è·¯å¾„**: éƒ½ä½¿ç”¨ `-Wl,-rpath,../../build/faiss`
8. **é“¾æ¥åº“**: éƒ½ä½¿ç”¨ `-lfaiss -lopenblas`

### ğŸ”„ åˆç†çš„å·®å¼‚
1. **æºæ–‡ä»¶å**: 
   - æ‚¨çš„: `benchmark-thread.cpp` (åŸç‰ˆæœ¬)
   - æˆ‘çš„: `benchmark-thread-disk.cpp` (ç£ç›˜ç›‘æ§ç‰ˆæœ¬)
   
2. **è¾“å‡ºæ–‡ä»¶å**:
   - æ‚¨çš„: `benchmark-thread` (åŸç‰ˆæœ¬)
   - æˆ‘çš„: `benchmark-thread-disk` (ç£ç›˜ç›‘æ§ç‰ˆæœ¬)

### ğŸ“‹ å‚æ•°é¡ºåºå·®å¼‚
è™½ç„¶å‚æ•°é¡ºåºç•¥æœ‰ä¸åŒï¼Œä½†åŠŸèƒ½å®Œå…¨ç›¸åŒï¼š

**æ‚¨çš„é¡ºåº**:
```
g++ [æ ‡å‡†] [ä¼˜åŒ–] [è¾“å‡º] [æºæ–‡ä»¶] [å¤´æ–‡ä»¶] [åº“è·¯å¾„] [è¿è¡Œæ—¶è·¯å¾„] [é“¾æ¥åº“] [OpenMP]
```

**æˆ‘çš„é¡ºåº**:
```
g++ [æ ‡å‡†] [ä¼˜åŒ–] [OpenMP] [å¤´æ–‡ä»¶] [æºæ–‡ä»¶] [è¾“å‡º] [åº“è·¯å¾„] [è¿è¡Œæ—¶è·¯å¾„] [é“¾æ¥åº“]
```

## éªŒè¯æ–¹æ³•

### 1. è¿è¡Œç¼–è¯‘æµ‹è¯•
```bash
./test_compilation.sh
```

### 2. æ‰‹åŠ¨éªŒè¯
```bash
# æµ‹è¯•åŸå§‹ç¼–è¯‘
g++ -std=c++17 -O3 -o benchmark-thread benchmark-thread.cpp -I ../.. -L ../../build/faiss -Wl,-rpath,../../build/faiss -lfaiss -lopenblas -fopenmp

# æµ‹è¯•æˆ‘çš„è„šæœ¬
./compile_disk_benchmark.sh
```

### 3. æ£€æŸ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la benchmark-thread benchmark-thread-disk

# æ£€æŸ¥ä¾èµ–åº“
ldd benchmark-thread | grep -E "(faiss|openblas|openmp)"
ldd benchmark-thread-disk | grep -E "(faiss|openblas|openmp)"
```

## ç»“è®º

### âœ… åŠŸèƒ½å®Œå…¨ä¸€è‡´
æˆ‘çš„ç¼–è¯‘è„šæœ¬ä¸æ‚¨åŸå…ˆçš„ç¼–è¯‘å‘½ä»¤åœ¨**åŠŸèƒ½ä¸Šå®Œå…¨ä¸€è‡´**ï¼ŒåŒ…æ‹¬ï¼š

1. **ç›¸åŒçš„ç¼–è¯‘å™¨é€‰é¡¹**: æ‰€æœ‰ç¼–è¯‘å‚æ•°éƒ½ç›¸åŒ
2. **ç›¸åŒçš„åº“ä¾èµ–**: é“¾æ¥ç›¸åŒçš„åº“æ–‡ä»¶
3. **ç›¸åŒçš„è·¯å¾„é…ç½®**: ä½¿ç”¨ç›¸åŒçš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶è·¯å¾„
4. **ç›¸åŒçš„ä¼˜åŒ–è®¾ç½®**: ä½¿ç”¨ç›¸åŒçš„ä¼˜åŒ–çº§åˆ«å’Œå¹¶è¡Œæ”¯æŒ

### ğŸ”„ åˆç†çš„å·®å¼‚
å”¯ä¸€çš„å·®å¼‚æ˜¯æ–‡ä»¶åï¼Œè¿™æ˜¯ä¸ºäº†åŒºåˆ†ï¼š
- **åŸç‰ˆæœ¬**: `benchmark-thread` (æ— ç£ç›˜ç›‘æ§)
- **ç£ç›˜ç›‘æ§ç‰ˆæœ¬**: `benchmark-thread-disk` (å¸¦ç£ç›˜ç›‘æ§)

### ğŸ“Š å®é™…æ•ˆæœ
ä¸¤ä¸ªç‰ˆæœ¬ç¼–è¯‘å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶å…·æœ‰ï¼š
- ç›¸åŒçš„ä¾èµ–åº“
- ç›¸åŒçš„ç¼–è¯‘é€‰é¡¹
- ç›¸åŒçš„è¿è¡Œæ—¶è¡Œä¸º
- ç›¸åŒçš„æ€§èƒ½ç‰¹å¾

**æ€»ç»“**: æˆ‘çš„ç¼–è¯‘è„šæœ¬ä¸æ‚¨åŸå…ˆçš„ç¼–è¯‘å‘½ä»¤åŠŸèƒ½å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯æ–‡ä»¶åä¸åŒï¼Œè¿™æ˜¯ä¸ºäº†åŒºåˆ†åŸç‰ˆæœ¬å’Œç£ç›˜ç›‘æ§ç‰ˆæœ¬ã€‚
